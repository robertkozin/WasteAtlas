---
import Head from "../../components/Head.astro";

import "../../styles/waste.css";

import { types as ctypes } from "../../colours";

import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
    const wastes = await getCollection("wastes", (waste) => {
        const hasSlug = waste.data.slug !== null;
        const hasCategory = waste.data.category !== null;
        return hasSlug && hasCategory;
    });
    return wastes.map((waste) => ({
        params: { waste: waste.data.slug },
        props: waste,
    }));
}

interface Props {
    waste: CollectionEntry<"wastes">;
}

const DIRECTUS_URL = import.meta.env.DIRECTUS_URL;

const waste = Astro.props.waste.data;
---

<html lang="en">
    <head>
        <Head />
        <title>{waste.name} - {waste.location}</title>
    </head>
    <body>
        <main>
            <section class="flex flex-row p-5 gap-2 pb-12">
                <div class="flex-6">
                    <h1>{waste.name}</h1>
                    <h2 style={`color: ${ctypes[waste.category].sub}`}>
                        {waste.location}
                    </h2>

                    <dl class="mt-1">
                        <dt>Type of waste</dt>
                        <dd class="capitalize">{waste.category}</dd>
                    </dl>

                    <p class="mt-3">{waste.description}</p>
                </div>

                <div class="flex-4">
                    <img
                        class="h-0 ml-auto min-h-full object-contain"
                        src={`${DIRECTUS_URL}/assets/${waste.image}`}
                    />
                </div>
            </section>

            <section
                class="projects p-10 flex flex-col gap-10"
                style={`background: ${ctypes[waste.category].banner}b3`}
            >
                {
                    waste.projects
                        ?.map((project) => project.project_id)
                        .map((project) => {
                            return (
                                <div class="project">
                                    <h3 class="text-3xl font-medium mb-4">
                                        {project.name}
                                    </h3>
                                    <div class="flex flex-row gap-10">
                                        <div class="flex-1">
                                            <img
                                                src={`${DIRECTUS_URL}/assets/${project.images[0].directus_files_id}?width=800`}
                                            />
                                        </div>
                                        <div
                                            class="desc flex-2"
                                            style={`background: ${ctypes[waste.category].banner}`}
                                            set:html={project.description}
                                        />
                                    </div>
                                </div>
                            );
                        })
                }
            </section>

            <div class="banner-wrap">
                <div class="banner">
                    <span>{waste.characteristics}</span><span
                        >{waste.characteristics}</span
                    >
                </div>
            </div>
        </main>
    </body>
</html>
